<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profesyonel Umre/Hac Teklif Aracı</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1000px;
        }
        .card {
            margin-bottom: 1.5rem;
        }
        .card-header {
            background-color: #003d73;
            color: white;
            font-weight: bold;
        }
        .input-group-text.currency-selector {
            width: 80px; /* Para birimi seçici genişliği */
        }
        #teklifSonucu {
            border: 2px dashed #003d73;
            padding: 2rem;
            background-color: #fff;
        }
        /* Placeholder rengini biraz daha belirgin yapmak için */
        .form-control::placeholder {
            color: #888;
            opacity: 1;
        }
    </style>
</head>
<body>

<div class="container my-5">
    <div class="text-center mb-4">
        <h1 class="display-5">Profesyonel Umre/Hac Teklif Aracı</h1>
        <p class="lead">Tüm maliyetleri girerek detaylı bir teklif oluşturun.</p>
    </div>

    <div class="card">
        <div class="card-header">
            Genel Bilgiler ve Kur Ayarları
        </div>
        <div class="card-body row">
            <div class="col-md-4 mb-3">
                <label for="groupSize" class="form-label">Grup Kişi Sayısı</label>
                <input type="number" class="form-control" id="groupSize" placeholder="örn: 40">
            </div>
            <div class="col-md-4 mb-3">
                <label for="usdRate" class="form-label">1 USD = ? SAR</label>
                <input type="number" step="0.01" class="form-control" id="usdRate" placeholder="örn: 3.75">
            </div>
            <div class="col-md-4 mb-3">
                <label for="eurRate" class="form-label">1 EUR = ? SAR</label>
                <input type="number" step="0.01" class="form-control" id="eurRate" placeholder="örn: 4.05">
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Medine-i Münevvere Otel Bilgileri</div>
                <div class="card-body">
                    <input type="text" class="form-control mb-3" id="medineOtelAdi" placeholder="Otel Adını Giriniz">
                    <div class="row mb-3">
                        <div class="col"><input type="text" class="form-control" id="medineGiris" placeholder="Giriş örn: 10.08.2025"></div>
                        <div class="col"><input type="text" class="form-control" id="medineCikis" placeholder="Çıkış örn: 14.08.2025"></div>
                    </div>
                    <label class="form-label">Kişi Başı Oda Fiyatları</label>
                    <div id="medinePrices"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Mekke-i Mükerreme Otel Bilgileri</div>
                <div class="card-body">
                    <input type="text" class="form-control mb-3" id="mekkeOtelAdi" placeholder="Otel Adını Giriniz">
                    <div class="row mb-3">
                        <div class="col"><input type="text" class="form-control" id="mekkeGiris" placeholder="Giriş örn: 14.08.2025"></div>
                        <div class="col"><input type="text" class="form-control" id="mekkeCikis" placeholder="Çıkış örn: 21.08.2025"></div>
                    </div>
                    <label class="form-label">Kişi Başı Oda Fiyatları</label>
                    <div id="mekkePrices"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">Vize ve Yemek Maliyetleri (Kişi Başı)</div>
        <div class="card-body row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Vize Ücreti</label>
                <div id="vizePrice"></div>
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Medine Yemek Ücreti</label>
                <div id="medineYemekPrice"></div>
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Mekke Yemek Ücreti</label>
                <div id="mekkeYemekPrice"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Ulaşım Maliyetleri</div>
        <div class="card-body">
            <p>Lütfen teklife dahil edilecek ulaşım türünü seçin ve maliyetleri girin.</p>
            <div id="ulasimOptions"></div>
        </div>
    </div>

    <button class="btn btn-primary btn-lg w-100" onclick="createProposal()">TEKLİFİ OLUŞTUR</button>

    <div id="teklifSonucu" class="mt-5" style="display:none;">
        </div>

</div>


<script>
    // Dinamik alanları oluşturan fonksiyon
    function createPriceInput(idPrefix, label, placeholder) {
        return `
        <div class="input-group mb-2">
            <span class="input-group-text" style="width: 70px;">${label}</span>
            <input type="number" class="form-control" id="${idPrefix}" placeholder="${placeholder}">
            <select class="form-select currency-selector" id="${idPrefix}Currency">
                <option value="SAR">SAR</option>
                <option value="USD" selected>USD</option>
                <option value="EUR">EUR</option>
            </select>
        </div>
        `;
    }

    function createTransportOption(id, label, placeholder, type = 'total') {
        const costLabel = type === 'total' ? 'Toplam Ücret' : 'Kişi Başı Ücret';
        return `
        <div class="input-group mb-3">
            <div class="input-group-text">
                <input class="form-check-input mt-0" type="radio" name="transportType" value="${id}" ${id === 'bus' ? 'checked' : ''}>
            </div>
            <span class="input-group-text" style="width: 150px;">${label}</span>
            <span class="input-group-text">${costLabel}</span>
            <input type="number" class="form-control" id="${id}Cost" placeholder="${placeholder}">
            <select class="form-select currency-selector" id="${id}CostCurrency">
                <option value="SAR">SAR</option>
                <option value="USD" selected>USD</option>
                <option value="EUR">EUR</option>
            </select>
        </div>
        `;
    }
    
    // Sayfa yüklendiğinde dinamik alanları doldur
    document.addEventListener('DOMContentLoaded', () => {
        const medinePricesDiv = document.getElementById('medinePrices');
        const mekkePricesDiv = document.getElementById('mekkePrices');
        const vizePriceDiv = document.getElementById('vizePrice');
        const medineYemekPriceDiv = document.getElementById('medineYemekPrice');
        const mekkeYemekPriceDiv = document.getElementById('mekkeYemekPrice');
        const ulasimOptionsDiv = document.getElementById('ulasimOptions');

        medinePricesDiv.innerHTML = createPriceInput('medineDbl', 'DBL', 'örn: 800') + createPriceInput('medineTrpl', 'TRPL', 'örn: 750') + createPriceInput('medineQuad', 'QUAD', 'örn: 700');
        mekkePricesDiv.innerHTML = createPriceInput('mekkeDbl', 'DBL', 'örn: 900') + createPriceInput('mekkeTrpl', 'TRPL', 'örn: 850') + createPriceInput('mekkeQuad', 'QUAD', 'örn: 800');
        
        vizePriceDiv.innerHTML = createPriceInput('vize', 'Vize', 'örn: 150');
        medineYemekPriceDiv.innerHTML = createPriceInput('medineYemek', 'Yemek', 'örn: 100');
        mekkeYemekPriceDiv.innerHTML = createPriceInput('mekkeYemek', 'Yemek', 'örn: 120');
        
        ulasimOptionsDiv.innerHTML = createTransportOption('bus', 'Otobüs (45 Kişi)', 'örn: 4500') +
                                    createTransportOption('high', 'High Araç (11 Kişi)', 'örn: 2200') +
                                    createTransportOption('gmc', 'GMC Araç', 'örn: 2800') +
                                    createTransportOption('train', 'Hızlı Tren', 'örn: 160', 'perPerson');
    });

    function getValue(id) {
        // Placeholder'lı bir input boşsa değeri 0 olarak kabul et
        const amount = parseFloat(document.getElementById(id).value) || 0;
        const currency = document.getElementById(id + 'Currency').value;
        return { amount, currency };
    }

    function getCostInSar(valueObj, rates) {
        if (valueObj.currency === 'USD') return valueObj.amount * rates.usd;
        if (valueObj.currency === 'EUR') return valueObj.amount * rates.eur;
        return valueObj.amount; // SAR
    }
    
    function createProposal() {
        const groupSize = parseInt(document.getElementById('groupSize').value) || 1;
        const rates = {
            usd: parseFloat(document.getElementById('usdRate').value) || 3.75, // Boşsa varsayılan kur al
            eur: parseFloat(document.getElementById('eurRate').value) || 4.05  // Boşsa varsayılan kur al
        };
        
        const hotelInfo = {
            medine: { name: document.getElementById('medineOtelAdi').value, checkin: document.getElementById('medineGiris').value, checkout: document.getElementById('medineCikis').value },
            mekke: { name: document.getElementById('mekkeOtelAdi').value, checkin: document.getElementById('mekkeGiris').value, checkout: document.getElementById('mekkeCikis').value }
        };

        const roomCostsSar = {
            dbl: getCostInSar(getValue('medineDbl'), rates) + getCostInSar(getValue('mekkeDbl'), rates),
            trpl: getCostInSar(getValue('medineTrpl'), rates) + getCostInSar(getValue('mekkeTrpl'), rates),
            quad: getCostInSar(getValue('medineQuad'), rates) + getCostInSar(getValue('mekkeQuad'), rates)
        };
        
        const otherCostsSar = getCostInSar(getValue('vize'), rates) + 
                              getCostInSar(getValue('medineYemek'), rates) +
                              getCostInSar(getValue('mekkeYemek'), rates);
        
        const transportType = document.querySelector('input[name="transportType"]:checked').value;
        let transportCostSar = 0;
        let transportLabel = '';

        const transportValue = getValue(transportType + 'Cost');
        if (transportType === 'train') {
            transportCostSar = getCostInSar(transportValue, rates); // Zaten kişi başı
            transportLabel = 'Hızlı Tren';
        } else {
            const totalCostSar = getCostInSar(transportValue, rates);
            transportCostSar = totalCostSar / groupSize;
            const transportInput = document.querySelector(`input[value=${transportType}]`);
            transportLabel = transportInput.closest('.input-group').querySelector('.input-group-text:nth-of-type(2)').innerText.trim();
        }

        const finalCostsSar = {
            dbl: roomCostsSar.dbl + otherCostsSar + transportCostSar,
            trpl: roomCostsSar.trpl + otherCostsSar + transportCostSar,
            quad: roomCostsSar.quad + otherCostsSar + transportCostSar
        };
        
        const formatter = (currency) => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: currency });

        const teklifHTML = `
            <div class="text-center">
                <h2>UMRE FİYAT TEKLİFİ</h2>
                <p class="lead">${new Date().toLocaleDateString('tr-TR')}</p>
            </div>
            <hr>
            <p><strong>Grup Büyüklüğü:</strong> ${document.getElementById('groupSize').value || 'N/A'} Kişi</p>
            
            <h5>Konaklama Detayları</h5>
            <ul>
                <li><strong>Medine Oteli:</strong> ${hotelInfo.medine.name || 'Belirtilmedi'} (${hotelInfo.medine.checkin || 'N/A'} - ${hotelInfo.medine.checkout || 'N/A'})</li>
                <li><strong>Mekke Oteli:</strong> ${hotelInfo.mekke.name || 'Belirtilmedi'} (${hotelInfo.mekke.checkin || 'N/A'} - ${hotelInfo.mekke.checkout || 'N/A'})</li>
            </ul>
            
            <h5>Ulaşım Detayı</h5>
            <p>Seçilen ulaşım aracı: <strong>${transportLabel}</strong></p>

            <h5 class="mt-4">Kişi Başı Toplam Fiyatlar</h5>
            <table class="table table-bordered table-striped mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>Oda Tipi</th>
                        <th>Suudi Arabistan Riyali (SAR)</th>
                        <th>ABD Doları (USD)</th>
                        <th>Euro (EUR)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Çift Kişilik (DBL)</strong></td>
                        <td>${formatter('SAR').format(finalCostsSar.dbl)}</td>
                        <td>${formatter('USD').format(finalCostsSar.dbl / rates.usd)}</td>
                        <td>${formatter('EUR').format(finalCostsSar.dbl / rates.eur)}</td>
                    </tr>
                    <tr>
                        <td><strong>Üç Kişilik (TRPL)</strong></td>
                        <td>${formatter('SAR').format(finalCostsSar.trpl)}</td>
                        <td>${formatter('USD').format(finalCostsSar.trpl / rates.usd)}</td>
                        <td>${formatter('EUR').format(finalCostsSar.trpl / rates.eur)}</td>
                    </tr>
                    <tr>
                        <td><strong>Dört Kişilik (QUAD)</strong></td>
                        <td>${formatter('SAR').format(finalCostsSar.quad)}</td>
                        <td>${formatter('USD').format(finalCostsSar.quad / rates.usd)}</td>
                        <td>${formatter('EUR').format(finalCostsSar.quad / rates.eur)}</td>
                    </tr>
                </tbody>
            </table>
            <div class="text-muted small mt-3">
                <p><strong>Fiyata Dahil Olanlar:</strong> Belirtilen otellerde konaklama, vize ücreti, belirtilen yemekler ve seçilen ulaşım hizmeti.</p>
                <p>Not: Bu teklif, girilen maliyetler ve 1 USD = ${rates.usd} SAR / 1 EUR = ${rates.eur} SAR kurları üzerinden hesaplanmıştır.</p>
            </div>
        `;
        
        const sonucDiv = document.getElementById('teklifSonucu');
        sonucDiv.innerHTML = teklifHTML;
        sonucDiv.style.display = 'block';
        sonucDiv.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>
